# Telegram Bot на aiogram 3

Telegram бот с системой прав доступа, логирования, управления пользователями, виртуальной валютой TPCoin, системой достижений и опциональной интеграцией TON Connect.

## Установка

1. Установите зависимости:
```bash
pip install -r requirements.txt
```

2. Создайте файл `config.json` в корне проекта со следующей структурой:
```json
{
  "BOT_TOKEN": "ваш_токен_бота",
  "CREATOR_ID": 123456789
}
```

   Чтобы получить токен бота:
   - Найдите [@BotFather](https://t.me/BotFather) в Telegram
   - Отправьте команду `/newbot`
   - Следуйте инструкциям
   - Скопируйте полученный токен в `BOT_TOKEN` в файле `config.json`

   Чтобы узнать свой Telegram ID:
   - Найдите [@userinfobot](https://t.me/userinfobot) в Telegram
   - Отправьте команду `/start`
   - Скопируйте ваш ID в `CREATOR_ID` в файле `config.json`

## Запуск

```bash
python bot.py
```

## Хранение данных

Бот использует **базу данных SQLite** (`bot_database.db`) для хранения данных. Все данные пользователей, балансы, достижения, логи и административная информация хранятся в базе данных.

### Структура базы данных:
- `users` - все пользователи бота
- `admins` - список администраторов
- `blacklist` - заблокированные пользователи
- `achievements` - список всех достижений
- `user_achievements` - достижения пользователей
- `balances` - балансы TPCoin пользователей
- `temp_bans` - временные баны
- `user_logs` - логи действий пользователей
- `admin_logs` - логи действий администраторов
- `admin_command_logs` - логи команд администраторов
- `system_logs` - системные логи
- `error_logs` - логи ошибок
- `transfer_logs` - логи переводов TPCoin

**Примечание:** Проект был мигрирован с файлов `.txt` на SQLite. Подробности миграции см. в `MIGRATION_README.md`.

## Команды

### Для всех пользователей:
- `/start` - запуск бота
- `/profile` - профиль пользователя
- `/balance` - баланс в TPCoin
- `/transfer количество id` - перевод TPCoin другому пользователю
- `/myach` - список достижений
- `/contact` - связаться с поддержкой
- `/tonconnect` - подключить TON кошелек (опционально, требует доступный манифест)
- `/tonconnect_disconnect` - отключить TON кошелек (опционально)
- `/help` - список доступных команд

### Для администраторов и создателя:
- `/ban id` - заблокировать пользователя
- `/unban id` - разблокировать пользователя
- `/tempban id часы причина` - временный бан
- `/massban id1 id2 ...` - массовый бан пользователей
- `/banlist` - список заблокированных пользователей
- `/achlist` - список всех достижений
- `/sendach idДОСТИЖЕНИЯ idАККАУНТА` - выдать достижение
- `/removeach idДОСТИЖЕНИЯ idПОЛЬЗОВАТЕЛЯ` - удалить достижение у пользователя
- `/masssendach idДОСТИЖЕНИЯ` - массовая выдача достижения
- `/addbalance сумма id` - добавить баланс пользователю
- `/removebalance сумма id` - снять баланс у пользователя
- `/topbalance` - топ пользователей по балансу
- `/sendsms текст` - рассылка всем пользователям
- `/sendprivat текст --id123456789` - отправка сообщения одному пользователю
- `/search id` - информация о пользователе
- `/userlogs` - последние 20 строк логов пользователей
- `/errorlogs` - последние 20 строк логов ошибок
- `/ping` - время отклика бота в миллисекундах

### Только для создателя:
- `/addadmin id` - назначить администратора
- `/unadmin id` - разжаловать администратора
- `/adminlist` - список всех администраторов
- `/sendcoin количество id` - перевести TPCoin
- `/masssendcoin сумма` - массовая выдача TPCoin всем пользователям
- `/newach id название` - создать новое достижение
- `/deleteach idДОСТИЖЕНИЯ` - удалить достижение из системы
- `/adminlogs` - логи администраторов
- `/systemlogs` - системные логи
- `/test` - статистика системы (размер БД, пинг бота, количество пользователей, новых пользователей за 24 часа, администраторов, достижений, активных временных банов)

## Возможности

- **Система прав доступа**: Трехуровневая система (Creator, Admin, User)
- **Система логирования**: Отдельные логи для пользователей, администраторов, системных событий и ошибок
- **Управление пользователями**: Регистрация пользователей, блокировка/разблокировка, временные баны
- **Система достижений**: Создание, выдача и управление достижениями для пользователей
- **Система баланса**: Виртуальная валюта TPCoin с переводами между пользователями
- **Система поддержки**: Поддержка пользователей с FSM состояниями для общения
- **Система рассылок**: Отправка сообщений всем пользователям или конкретному пользователю
- **Интеграция TON Connect**: Опциональное подключение TON кошельков (требует доступный манифест)
- **Статистика**: Статистика системы и мониторинг
- **База данных SQLite**: Надежное хранение данных с автоматической миграцией

## TON Connect (Опционально)

Бот включает опциональную интеграцию TON Connect для подключения TON кошельков. Если манифест TON Connect недоступен, бот запустится нормально, но команды, связанные с TON (`/tonconnect`, `/tonconnect_disconnect`), будут недоступны.

URL манифеста настраивается в `bot.py` (по умолчанию: репозиторий GitHub). Если вы хотите использовать TON Connect:
1. Убедитесь, что манифест доступен по настроенному URL
2. Бот автоматически включит функции TON Connect, если манифест доступен
3. Если манифест недоступен, бот продолжит работать без функций TON

## Лицензия

Этот проект является открытым исходным кодом и доступен для использования.

